if($<$<CONFIG:Debug>:1>)
    get_filename_component(root_dir "${CMAKE_CURRENT_LIST_DIR}" DIRECTORY)
    # Compile generated coverage counts into a single coverage.info
    execute_process(
        COMMAND lcov --directory ${CMAKE_CURRENT_LIST_DIR} --capture --output-file coverage.info)
    # Take only coverage of the core library, not apps
    execute_process(
        COMMAND lcov --extract coverage.info "${root_dir}/src/h3lib/*" --output-file coverage.cleaned.info)
    # Generate output html at coverage/
    execute_process(
        COMMAND genhtml -o coverage coverage.cleaned.info --title "h3 coverage")
    message(STATUS "Coverage done")
else()
    message(FATAL_ERROR "Cannot run coverage on non-debug build")
endif()
